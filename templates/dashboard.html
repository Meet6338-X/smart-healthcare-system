{% extends "base.html" %}

{% block title %}Dashboard - Smart Healthcare System{% endblock %}

{% block content %}
<section class="dashboard">
    <div class="dashboard-header">
        <div class="welcome-section">
            <h1>Welcome, {{ user_name }}!</h1>
            <p class="user-role">{{ session.get('role', 'Patient') }}</p>
        </div>
        <div class="header-actions">
            <a href="{{ url_for('book_appointment') }}" class="btn btn-primary">
                <span>üìÖ</span> Book Appointment
            </a>
        </div>
    </div>

    <!-- Stats Cards -->
    <div class="stats-cards">
        <div class="stat-card">
            <div class="stat-icon blue">üìÖ</div>
            <div class="stat-content">
                <h3>{{ upcoming_count }}</h3>
                <p>Upcoming Appointments</p>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-icon green">‚úÖ</div>
            <div class="stat-content">
                <h3>{{ completed_count }}</h3>
                <p>Completed Visits</p>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-icon orange">üí∞</div>
            <div class="stat-content">
                <h3>‚Çπ{{ pending_amount }}</h3>
                <p>Pending Bills</p>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-icon purple">üìã</div>
            <div class="stat-content">
                <h3>{{ records_count }}</h3>
                <p>Medical Records</p>
            </div>
        </div>
    </div>

    <!-- Upcoming Appointments -->
    <div class="dashboard-section">
        <div class="section-header">
            <h2>Upcoming Appointments</h2>
            <a href="#" class="view-all">View All ‚Üí</a>
        </div>
        
        {% if appointments %}
        <div class="appointments-list">
            {% for apt in appointments %}
            <div class="appointment-card">
                <div class="apt-date">
                    <span class="apt-day">{{ apt.date_day }}</span>
                    <span class="apt-month">{{ apt.date_month }}</span>
                </div>
                <div class="apt-details">
                    <h4>Dr. {{ apt.doctor_name }}</h4>
                    <p class="apt-specialty">{{ apt.specialization }}</p>
                    <p class="apt-time">üïê {{ apt.time }}</p>
                </div>
                <div class="apt-status status-{{ apt.status | lower }}">
                    {{ apt.status }}
                </div>
                <div class="apt-actions">
                    {% if apt.status == 'SCHEDULED' %}
                    <button class="btn btn-outline btn-sm" onclick="cancelAppointment({{ apt.id }})">Cancel</button>
                    {% endif %}
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="empty-state">
            <span class="empty-icon">üìÖ</span>
            <h3>No Upcoming Appointments</h3>
            <p>You don't have any scheduled appointments.</p>
            <a href="{{ url_for('book_appointment') }}" class="btn btn-primary">Book Now</a>
        </div>
        {% endif %}
    </div>

    <!-- Recent Medical Records -->
    <div class="dashboard-section">
        <div class="section-header">
            <h2>Recent Medical Records</h2>
            <a href="#" class="view-all">View All ‚Üí</a>
        </div>
        
        {% if records %}
        <div class="records-table">
            <table>
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Doctor</th>
                        <th>Diagnosis</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for record in records %}
                    <tr>
                        <td>{{ record.date }}</td>
                        <td>Dr. {{ record.doctor_name }}</td>
                        <td>{{ record.diagnosis }}</td>
                        <td>
                            <button class="btn btn-outline btn-sm">View</button>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <div class="empty-state small">
            <p>No medical records yet.</p>
        </div>
        {% endif %}
    </div>
</section>
{% endblock %}

{% block scripts %}
<script>
function cancelAppointment(appointmentId) {
    if (confirm('Are you sure you want to cancel this appointment?')) {
        fetch('/cancel-appointment/' + appointmentId, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                location.reload();
            } else {
                alert(data.message || 'Failed to cancel appointment');
            }
        })
        .catch(error => {
            alert('An error occurred');
        });
    }
}
</script>
{% endblock %}
